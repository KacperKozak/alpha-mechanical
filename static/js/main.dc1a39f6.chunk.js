(this["webpackJsonpalpha-mechanical"]=this["webpackJsonpalpha-mechanical"]||[]).push([[0],{69:function(e,t,n){e.exports=n(80)},79:function(e,t,n){},80:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(17),i=n.n(c),u=n(30),l=n(18),s=n(58),d=n(84),f=n(25),b=n(8),m=n(10),p=n(59),h=n.n(p),v=n(60),j=n(5),g=function(e,t){return e.find((function(e){return e.id===t}))},w=function(e,t){return e.filter((function(e){return function(e,t){var n=Object(j.a)(e,2),a=n[0],r=n[1],o=Object(j.a)(t,2),c=o[0],i=o[1];return a===c&&r===i}(e.xy,t)}))},O=function(e){return Array.isArray(e)?e:[e]},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(b.a)(e),Object(b.a)(O(t)))},y=n(2),I=n(11);!function(e){e[e.Grass=0]="Grass",e[e.Ice=1]="Ice",e[e.Rock=2]="Rock",e[e.Button=3]="Button",e[e.Player=4]="Player",e[e.TestProp=5]="TestProp"}(a||(a={}));var S,x,C=n(16),k=n(47),_=n(1),q=function(e){var t=e.url,n=e.xy,a=e.elevation,r=(e.rotation,e.castShadow),c=void 0===r||r,i=e.receiveShadow,u=void 0===i||i,l=Object(C.c)(k.a,"/assets/".concat(t));return c&&(l.scene.children[0].castShadow=!0),u&&(l.scene.children[0].receiveShadow=!0),l.scene.scale.set(.5,.5,.5),l.scene=l.scene.clone(),o.a.createElement("primitive",{object:l.scene,dispose:null,position:[n[0],a,n[1]],rotation:[0,0,0]})},A=function(e){var t=e.url,n=e.xy,a=e.elevation,r=(e.rotation,e.castShadow),c=void 0===r||r,i=e.receiveShadow,u=void 0===i||i,l=Object(C.c)(k.a,"/assets/".concat(t)),s=Object(C.c)(k.a,"/assets/animations/boring.gltf");c&&(l.scene.children[0].castShadow=!0),u&&(l.scene.children[0].receiveShadow=!0),l.scene.scale.set(.5,.5,.5),l.scene=l.scene.clone();var d=new _.AnimationMixer(s.scene);return s.animations.forEach((function(e){d.clipAction(e,l.scene.children[0]).play()})),Object(C.b)((function(){d.update(.02)})),o.a.createElement("primitive",{object:l.scene,dispose:null,position:[n[0],a,n[1]],rotation:[0,0,0]})},T=[0,-1],R=[1,0],z=[0,1],M=[-1,0],P=(S={},Object(y.a)(S,a.Grass,{name:"Grass",getId:function(){return Object(I.uniqueId)("grass")},canEnter:function(){return!0},Component:function(){return o.a.createElement("div",{style:{width:50,height:50,backgroundColor:"green"}})},Component3d:function(e){return o.a.createElement(q,Object.assign({},e,{url:"grass_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.Ice,{name:"Ice",getId:function(){return Object(I.uniqueId)("ice")},canEnter:function(){return!0},enter:function(e){var t=e.who,n=e.vector;return[Y({targetId:t.id,vector:n})]},Component:function(){return o.a.createElement("div",{style:{width:50,height:50,backgroundColor:"lightblue"}})},Component3d:function(e){return o.a.createElement(q,Object.assign({},e,{url:"ice_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.Rock,{name:"Rock",getId:function(){return Object(I.uniqueId)("rock")},canEnter:function(){return!1},Component:function(){return o.a.createElement("div",{style:{width:50,height:50,backgroundColor:"gray"}})},Component3d:function(e){return o.a.createElement(q,Object.assign({},e,{url:"ground_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.Button,{name:"Button",getId:function(){return Object(I.uniqueId)("button")},canEnter:function(){return!1},push:function(e){var t=e.state,n=Object(I.sample)(t.objects.filter((function(e){return"player"!==e.id})));return n?[Z(n.id)]:[]},Component:function(){return o.a.createElement("div",{style:{width:50,height:50,backgroundColor:"gray",display:"flex",justifyContent:"center",alignItems:"center"}},o.a.createElement("button",{style:{fontSize:10}},"btn"))},Component3d:function(e){return o.a.createElement(q,Object.assign({},e,{url:"ground_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),S),B=(x={},Object(y.a)(x,a.Player,{name:"Player",getId:function(){return"player"},canEnter:function(){return!0},Component:function(){return o.a.createElement("div",{style:{margin:12.5,width:25,height:25,backgroundColor:"white",borderRadius:5}})},Component3d:function(e){return o.a.createElement(A,Object.assign({},e,{url:"robot_model.gltf"}))}}),Object(y.a)(x,a.TestProp,{name:"TestProp",getId:function(){return Object(I.uniqueId)("test-prop")},canEnter:function(){return!0},enter:function(e){var t=e.self;return[Z(t.id)]},Component:function(){return o.a.createElement("div",{style:{margin:12.5,width:25,height:25,backgroundColor:"brown",borderRadius:5}})},Component3d:function(e){return o.a.createElement(q,Object.assign({},e,{url:"rock1.gltf"}))}}),x),G={0:a.Grass,1:a.Rock,2:a.Button,3:a.Ice},L=[[1,1,1,1,2,1,1],[1,0,3,3,0,0,1],[1,0,0,1,1,0,1],[1,0,0,1,0,0,1],[1,1,1,1,1,1,1]],N={1:a.Player,2:a.TestProp},U=[[0,0,0,0,0,0,0],[0,1,0,0,0,0,0],[0,0,0,0,0,0,0],[0,2,0,0,2,0,2],[0,0,0,0,0,0,0]],D=Object(m.a)({},P,{},B),F=function(e){var t=D[e];if(!t)throw new Error("[getDefinition] Definition for ".concat(e," not found"));return t},H={queueStared:!1,queue:[],objects:function(){var e=L.flatMap((function(e,t){return e.map((function(e,n){var a=G[e];return{type:a,xy:[n,t],id:P[a].getId(),elevation:Math.random()/7,rotation:[0,0],zIndex:1,aIndex:100}}))})),t=U.flatMap((function(t,n){return t.map((function(t,a){var r,o=N[t];if(o)return{type:o,xy:[a,n],id:B[o].getId(),elevation:(null===(r=w(e,[a,n])[0])||void 0===r?void 0:r.elevation)||0,rotation:[0,0],zIndex:2,aIndex:10}}))})).filter((function(e){return e}));return[].concat(Object(b.a)(t),Object(b.a)(e))}()},J=h()("GAME"),Q=J("ENQUEUE"),V=J("TRY_NEXT_ACTION"),W=J("NEXT_ACTION"),X=J("QUEUE_END"),Y=J("MOVE"),K=J("ROTATE"),Z=J("REMOVE"),$=Object(v.reducerWithInitialState)(H).case(Q,(function(e,t){return Object(m.a)({},e,{queue:E(e.queue,t)})})).case(W,(function(e,t){return Object(m.a)({},e,{queueStared:!0,queue:e.queue.filter((function(e){return e!==t}))})})).case(X,(function(e){return Object(m.a)({},e,{queueStared:!1})})).case(Y,(function(e,t){var n=t.targetId,a=t.vector,r=te(e,n,a),o=r.actions,c=r.objects;return Object(m.a)({},e,{queue:E(e.queue,o),objects:c})})).case(K,(function(e,t){var n=t.targetId,a=t.rotation,r=ee(e,n,a),o=r.actions,c=r.objects;return Object(m.a)({},e,{queue:E(e.queue,o),objects:c})})).case(Z,(function(e,t){return Object(m.a)({},e,{objects:e.objects.filter((function(e){return e.id!==t}))})})),ee=function(e,t,n){var a=e.objects,r=g(a,t);return{objects:a.map((function(e){return e!==r?e:Object(m.a)({},e,{rotation:n})})),actions:[]}},te=function(e,t,n){var a=e.objects,r=[],o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.push.apply(r,Object(b.a)(O(e)))},c={objects:a,actions:r},i=g(a,t);if(!i)return console.warn("[move] Target ".concat(t," not found")),c;var u,l=function(e,t){var n=Object(j.a)(e,2),a=n[0],r=n[1],o=Object(j.a)(t,2);return[a+o[0],r+o[1]]}(i.xy,n),s=w(a,l).sort((function(e,t){return t.aIndex-e.aIndex})),d=Object(f.a)(s);try{for(d.s();!(u=d.n()).done;){var p,h=u.value,v=F(h.type),E={who:i,vector:n,state:e,self:h};if(!v.canEnter(E))return o(null===(p=v.push)||void 0===p?void 0:p.call(v,E)),{objects:a,actions:r}}}catch(_){d.e(_)}finally{d.f()}var y,I=Object(f.a)(s);try{for(I.s();!(y=I.n()).done;){var S,x=y.value,C=F(x.type),k={who:i,vector:n,state:e,self:x};o(null===(S=C.enter)||void 0===S?void 0:S.call(C,k))}}catch(_){I.e(_)}finally{I.f()}return{objects:a=a.map((function(e){return e!==i?e:Object(m.a)({},e,{xy:l})})),actions:r}},ne=n(86),ae=n(87),re=n(42),oe=n(82),ce=n(83),ie=n(65),ue=n(67),le=n(85),se=Object(ne.a)((function(e,t){return e.pipe(Object(oe.a)(Q.match),Object(oe.a)((function(){return!t.value.game.queueStared})),Object(ce.a)(V()))}),(function(e,t){return e.pipe(Object(oe.a)(V.match),Object(ie.a)((function(){return Object(I.first)(t.value.game.queue)})),Object(ie.a)((function(e){return e?W(e):X()})))}),(function(e,t){return e.pipe(Object(oe.a)(W.match),Object(ue.a)((function(e){return Object(ae.a)(Object(re.a)(e.payload),Object(re.a)(V()).pipe(Object(le.a)(150)))})))})),de=Object(d.a)(),fe=Object(s.composeWithDevTools)({name:"App"}),be=Object(l.combineReducers)({game:$}),me=Object(l.createStore)(be,fe(Object(l.applyMiddleware)(de)));de.run(se);var pe=function(){var e=Object(u.c)((function(e){return e.game})),t=Object(u.b)();return Object(m.a)({},e,{move:function(n,a){if(!e.queueStared){var r=[],o=g(e.objects,n);if(!o)return console.warn("Unknown target ".concat(n));Object(I.isEqual)(o.rotation,a)?r.push(Y({targetId:n,vector:a})):r.push(K({targetId:n,rotation:a})),t(Q(r))}}})},he=function(e,t){Object(r.useEffect)((function(){var n=function(n){n.key===e&&t()};return window.addEventListener("keydown",n),function(){return window.removeEventListener("keydown",n)}}))},ve=function(e){var t=e.objects,n=pe().move,r=function(){return n("player",M)},c=function(){return n("player",T)},i=function(){return n("player",z)},u=function(){return n("player",R)};return he("ArrowLeft",r),he("ArrowUp",c),he("ArrowDown",i),he("ArrowRight",u),o.a.createElement("div",{style:{position:"absolute",zIndex:100,top:0,right:0,width:400,opacity:.8}},o.a.createElement("button",{onClick:r},"\u2190"),o.a.createElement("button",{onClick:c},"\u2191"),o.a.createElement("button",{onClick:i},"\u2193"),o.a.createElement("button",{onClick:u},"\u2192"),o.a.createElement("div",{style:{position:"relative"}},t.map((function(e){var t=e.type,n=e.id,r=e.xy,c=e.rotation,i=e.elevation,u=e.zIndex,l=F(t).Component;return o.a.createElement("div",{key:n,style:{position:"absolute",left:50*r[0],top:50*r[1],width:50,height:50,zIndex:u}},o.a.createElement(je,{text:n+c.toString()}),t===a.Player&&o.a.createElement(je,{text:c.toString(),bottom:!0}),o.a.createElement(l,{xy:r,rotation:c,elevation:i}))}))))},je=function(e){var t=e.text,n=e.bottom;return o.a.createElement("div",{style:{position:"absolute",left:0,top:n?"80%":0,fontSize:10,color:"black"}},t)},ge=function(){return o.a.createElement("group",null,o.a.createElement("ambientLight",{intensity:2}),o.a.createElement("pointLight",{position:[6,7,8],intensity:2.2,color:new _.Color("#3a8dc2"),"shadow-mapSize-Height":"1024","shadow-mapSize-width":"1024","shadow-camera-far":30,"shadow-bias":-.01,castShadow:!0,"shadow-camera-left":-5,"shadow-camera-right":5,"shadow-camera-top":5,"shadow-camera-bottom":-5}),o.a.createElement("pointLight",{position:[1,3,5],intensity:2.2,color:new _.Color("#c86b6f"),"shadow-mapSize-Height":"1024","shadow-mapSize-width":"1024","shadow-camera-far":30,"shadow-bias":-.01,castShadow:!0,"shadow-camera-left":-5,"shadow-camera-right":5,"shadow-camera-top":5,"shadow-camera-bottom":-5}))},we=function(){var e=pe().objects;Object(C.d)().gl;return o.a.createElement(o.a.Fragment,null,o.a.createElement(ve,{objects:e}),o.a.createElement(C.a,{orthographic:!0,camera:{zoom:100,fov:1075,position:[0,5,7]},onCreated:function(e){e.camera.lookAt(3,1,2),e.gl.shadowMap.type=_.PCFSoftShadowMap,e.gl.shadowMap.enabled=!0}},o.a.createElement(ge,null),o.a.createElement(r.Suspense,{fallback:o.a.createElement("mesh",null,o.a.createElement("boxBufferGeometry",{attach:"geometry",args:[.5,.5,.5]}),o.a.createElement("meshStandardMaterial",{attach:"material",color:"red"}))},e.map((function(e){var t=e.type,n=e.id,a=e.xy,r=e.elevation,c=e.rotation,i=F(t).Component3d;return o.a.createElement(i,{xy:a,rotation:c,elevation:r,key:n})})))))},Oe=function(){return o.a.createElement(u.a,{store:me},o.a.createElement("div",null,o.a.createElement("h1",{style:{position:"fixed",top:0,left:0,right:0,width:"300px",background:"rgba(0,0,0,0.2)",margin:"0 auto",borderRadius:"0 0 15px 15px"}},"alpha-mechanical"),o.a.createElement(we,null)))};n(79);i.a.render(o.a.createElement(Oe,null),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.dc1a39f6.chunk.js.map