(this["webpackJsonpalpha-mechanical"]=this["webpackJsonpalpha-mechanical"]||[]).push([[0],{73:function(e,t,n){e.exports=n(84)},83:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(22),i=n.n(c),u=n(33),l=n(23),s=n(62),d=n(88),f=n(18),b=n(7),m=n(11),h=n(63),p=n.n(h),v=n(64),j=n(5),g=function(e,t){return e.find((function(e){return e.id===t}))},w=function(e,t){return e.filter((function(e){return function(e,t){var n=Object(j.a)(e,2),a=n[0],r=n[1],o=Object(j.a)(t,2),c=o[0],i=o[1];return a===c&&r===i}(e.xy,t)}))},O=function(e){return Array.isArray(e)?e:[e]},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(b.a)(e),Object(b.a)(O(t)))},y=n(2),I=n(13);!function(e){e[e.Grass=0]="Grass",e[e.Ice=1]="Ice",e[e.Rock=2]="Rock",e[e.Button=3]="Button",e[e.Player=4]="Player",e[e.TestProp=5]="TestProp"}(a||(a={}));var S,x,C=n(12),k=n(50),_=n(1),q=n(56),M=function(e){var t=e.url,n=e.xy,a=e.elevation,r=e.rotation,c=e.castShadow,i=void 0===c||c,u=e.receiveShadow,l=void 0===u||u,s=Object(C.f)(k.a,"".concat("/alpha-mechanical","/assets/").concat(t));return i&&(s.scene.children[0].castShadow=!0),l&&(s.scene.children[0].receiveShadow=!0),s.scene.scale.set(.5,.5,.5),s.scene=s.scene.clone(),o.a.createElement("primitive",{object:s.scene,dispose:null,position:[n[0],a,n[1]],rotation:[0,A(r),0]})},P=function(e){var t=e.url,n=e.xy,a=e.elevation,r=e.rotation,c=e.castShadow,i=void 0===c||c,u=e.receiveShadow,l=void 0===u||u,s=Object(q.b)({pos:[n[0],a,n[1]],rot:[0,A(r),0]}),d=Object(C.f)(k.a,"".concat("/alpha-mechanical","/assets/").concat(t)),f=Object(C.f)(k.a,"".concat("/alpha-mechanical","/assets/animations/boring.gltf"));i&&(d.scene.children[0].castShadow=!0),l&&(d.scene.children[0].receiveShadow=!0),d.scene.scale.set(.5,.5,.5),d.scene=d.scene.clone();var b=new _.AnimationMixer(f.scene);return f.animations.forEach((function(e){b.clipAction(e,d.scene.children[0]).play()})),Object(C.e)((function(){b.update(.02)})),o.a.createElement(q.a.primitive,{object:d.scene,dispose:null,position:s.pos,rotation:s.rot})},A=function(e){return 1===e[0]&&0===e[1]?Math.PI/2:0===e[0]&&-1===e[1]?Math.PI/2*2:-1===e[0]&&0===e[1]?Math.PI/2*3:0===e[0]&&1===e[1]?Math.PI/2*4:0},T=[0,-1],z=[1,0],R=[0,1],B=[-1,0],G=(S={},Object(y.a)(S,a.Grass,{name:"Grass",getId:function(){return Object(I.uniqueId)("grass")},canEnter:function(){return!0},Component:function(){return o.a.createElement("div",{style:{width:50,height:50,backgroundColor:"green"}})},Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"grass_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.Ice,{name:"Ice",getId:function(){return Object(I.uniqueId)("ice")},canEnter:function(){return!0},enter:function(e){var t=e.who,n=e.vector;return[Z({targetId:t.id,vector:n})]},Component:function(){return o.a.createElement("div",{style:{width:50,height:50,backgroundColor:"lightblue"}})},Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"ice_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.Rock,{name:"Rock",getId:function(){return Object(I.uniqueId)("rock")},canEnter:function(){return!1},Component:function(){return o.a.createElement("div",{style:{width:50,height:50,backgroundColor:"gray"}})},Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"ground_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.Button,{name:"Button",getId:function(){return Object(I.uniqueId)("button")},canEnter:function(){return!1},push:function(e){var t=e.state,n=Object(I.sample)(t.objects.filter((function(e){return"player"!==e.id})));return n?[ee(n.id)]:[]},Component:function(){return o.a.createElement("div",{style:{width:50,height:50,backgroundColor:"gray",display:"flex",justifyContent:"center",alignItems:"center"}},o.a.createElement("button",{style:{fontSize:10}},"btn"))},Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"ground_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),S),L=(x={},Object(y.a)(x,a.Player,{name:"Player",getId:function(){return"player"},canEnter:function(){return!0},Component:function(){return o.a.createElement("div",{style:{margin:12.5,width:25,height:25,backgroundColor:"white",borderRadius:5}})},Component3d:function(e){return o.a.createElement(P,Object.assign({},e,{url:"robot_model.gltf"}))}}),Object(y.a)(x,a.TestProp,{name:"TestProp",getId:function(){return Object(I.uniqueId)("test-prop")},canEnter:function(){return!0},enter:function(e){var t=e.self;return[ee(t.id)]},Component:function(){return o.a.createElement("div",{style:{margin:12.5,width:25,height:25,backgroundColor:"brown",borderRadius:5}})},Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"rock1.gltf"}))}}),x),N={0:a.Grass,1:a.Rock,2:a.Button,3:a.Ice},U=[[1,1,1,1,2,1,1],[1,0,3,3,0,0,1],[1,0,0,1,1,0,1],[1,0,0,1,0,0,1],[1,1,1,1,1,1,1]],D={1:a.Player,2:a.TestProp},F=[[0,0,0,0,0,0,0],[0,1,0,0,0,0,0],[0,0,0,0,0,0,0],[0,2,0,0,2,0,2],[0,0,0,0,0,0,0]],H=Object(m.a)({},G,{},L),J=function(e){var t=H[e];if(!t)throw new Error("[getDefinition] Definition for ".concat(e," not found"));return t},Q={queueStared:!1,queue:[],objects:function(){var e=U.flatMap((function(e,t){return e.map((function(e,n){var a=N[e];return{type:a,xy:[n,t],id:G[a].getId(),elevation:Math.random()/7,rotation:[0,0],zIndex:1,aIndex:100}}))})),t=F.flatMap((function(t,n){return t.map((function(t,a){var r,o=D[t];if(o)return{type:o,xy:[a,n],id:L[o].getId(),elevation:(null===(r=w(e,[a,n])[0])||void 0===r?void 0:r.elevation)||0,rotation:[0,0],zIndex:2,aIndex:10}}))})).filter((function(e){return e}));return[].concat(Object(b.a)(t),Object(b.a)(e))}()},V=p()("GAME"),W=V("ENQUEUE"),X=V("TRY_NEXT_ACTION"),Y=V("NEXT_ACTION"),K=V("QUEUE_END"),Z=V("MOVE"),$=V("ROTATE"),ee=V("REMOVE"),te=Object(v.reducerWithInitialState)(Q).case(W,(function(e,t){return Object(m.a)({},e,{queue:E(e.queue,t)})})).case(Y,(function(e,t){return Object(m.a)({},e,{queueStared:!0,queue:e.queue.filter((function(e){return e!==t}))})})).case(K,(function(e){return Object(m.a)({},e,{queueStared:!1})})).case(Z,(function(e,t){var n=t.targetId,a=t.vector,r=ae(e,n,a),o=r.actions,c=r.objects;return Object(m.a)({},e,{queue:E(e.queue,o),objects:c})})).case($,(function(e,t){var n=t.targetId,a=t.rotation,r=ne(e,n,a),o=r.actions,c=r.objects;return Object(m.a)({},e,{queue:E(e.queue,o),objects:c})})).case(ee,(function(e,t){return Object(m.a)({},e,{objects:e.objects.filter((function(e){return e.id!==t}))})})),ne=function(e,t,n){var a=e.objects,r=g(a,t);return{objects:a.map((function(e){return e!==r?e:Object(m.a)({},e,{rotation:n})})),actions:[]}},ae=function(e,t,n){var a=e.objects,r=[],o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.push.apply(r,Object(b.a)(O(e)))},c={objects:a,actions:r},i=g(a,t);if(!i)return console.warn("[move] Target ".concat(t," not found")),c;var u,l=function(e,t){var n=Object(j.a)(e,2),a=n[0],r=n[1],o=Object(j.a)(t,2);return[a+o[0],r+o[1]]}(i.xy,n),s=w(a,l).sort((function(e,t){return t.aIndex-e.aIndex})),d=Object(f.a)(s);try{for(d.s();!(u=d.n()).done;){var h,p=u.value,v=J(p.type),E={who:i,vector:n,state:e,self:p};if(!v.canEnter(E))return o(null===(h=v.push)||void 0===h?void 0:h.call(v,E)),{objects:a,actions:r}}}catch(_){d.e(_)}finally{d.f()}var y,I=Object(f.a)(s);try{for(I.s();!(y=I.n()).done;){var S,x=y.value,C=J(x.type),k={who:i,vector:n,state:e,self:x};o(null===(S=C.enter)||void 0===S?void 0:S.call(C,k))}}catch(_){I.e(_)}finally{I.f()}return{objects:a=a.map((function(e){return e!==i?e:Object(m.a)({},e,{xy:l})})),actions:r}},re=n(91),oe=n(90),ce=n(45),ie=n(86),ue=n(87),le=n(69),se=n(71),de=n(89),fe=Object(re.a)((function(e,t){return e.pipe(Object(ie.a)(W.match),Object(ie.a)((function(){return!t.value.game.queueStared})),Object(ue.a)(X()))}),(function(e,t){return e.pipe(Object(ie.a)(X.match),Object(le.a)((function(){return Object(I.first)(t.value.game.queue)})),Object(le.a)((function(e){return e?Y(e):K()})))}),(function(e,t){return e.pipe(Object(ie.a)(Y.match),Object(se.a)((function(e){var t;return Object(oe.a)(Object(ce.a)(e.payload),Object(ce.a)(X()).pipe(Object(de.a)((null===(t=e.meta)||void 0===t?void 0:t.delay)||50)))})))})),be=Object(d.a)(),me=Object(s.composeWithDevTools)({name:"App"}),he=Object(l.combineReducers)({game:te}),pe=Object(l.createStore)(he,me(Object(l.applyMiddleware)(be)));be.run(fe);var ve=function(){var e=Object(u.c)((function(e){return e.game})),t=Object(u.b)();return Object(m.a)({},e,{move:function(n,a){if(!e.queueStared){var r=[],o=g(e.objects,n);if(!o)return console.warn("Unknown target ".concat(n));Object(I.isEqual)(o.rotation,a)?r.push(Z({targetId:n,vector:a})):r.push($({targetId:n,rotation:a})),t(W(r))}}})},je=function(e,t){Object(r.useEffect)((function(){var n=function(n){n.key===e&&t()};return window.addEventListener("keydown",n),function(){return window.removeEventListener("keydown",n)}}))},ge=function(e){var t=e.objects,n=ve().move,r=function(){return n("player",B)},c=function(){return n("player",T)},i=function(){return n("player",R)},u=function(){return n("player",z)};return je("ArrowLeft",r),je("ArrowUp",c),je("ArrowDown",i),je("ArrowRight",u),o.a.createElement("div",{style:{position:"absolute",zIndex:100,top:0,right:0,width:400,opacity:.8}},o.a.createElement("button",{onClick:r},"\u2190"),o.a.createElement("button",{onClick:c},"\u2191"),o.a.createElement("button",{onClick:i},"\u2193"),o.a.createElement("button",{onClick:u},"\u2192"),o.a.createElement("div",{style:{position:"relative"}},t.map((function(e){var t=e.type,n=e.id,r=e.xy,c=e.rotation,i=e.elevation,u=e.zIndex,l=J(t).Component;return o.a.createElement("div",{key:n,style:{position:"absolute",left:50*r[0],top:50*r[1],width:50,height:50,zIndex:u}},o.a.createElement(we,{text:n+c.toString()}),t===a.Player&&o.a.createElement(we,{text:c.toString(),bottom:!0}),o.a.createElement(l,{xy:r,rotation:c,elevation:i}))}))))},we=function(e){var t=e.text,n=e.bottom;return o.a.createElement("div",{style:{position:"absolute",left:0,top:n?"80%":0,fontSize:10,color:"black"}},t)},Oe=function(){return o.a.createElement("group",null,o.a.createElement("ambientLight",{intensity:2}),o.a.createElement("pointLight",{position:[6,7,8],intensity:2.2,color:new _.Color("#3a8dc2"),"shadow-mapSize-Height":"1024","shadow-mapSize-width":"1024","shadow-camera-far":30,"shadow-bias":-.01,castShadow:!0,"shadow-camera-left":-5,"shadow-camera-right":5,"shadow-camera-top":5,"shadow-camera-bottom":-5}),o.a.createElement("pointLight",{position:[1,3,5],intensity:2.2,color:new _.Color("#c86b6f"),"shadow-mapSize-Height":"1024","shadow-mapSize-width":"1024","shadow-camera-far":30,"shadow-bias":-.01,castShadow:!0,"shadow-camera-left":-5,"shadow-camera-right":5,"shadow-camera-top":5,"shadow-camera-bottom":-5}))},Ee=function(){var e=ve().objects;Object(C.g)().gl;return o.a.createElement(o.a.Fragment,null,o.a.createElement(ge,{objects:e}),o.a.createElement(C.a,{orthographic:!0,camera:{zoom:100,fov:1075,position:[0,5,7]},onCreated:function(e){e.camera.lookAt(3,1,2),e.gl.shadowMap.type=_.PCFSoftShadowMap,e.gl.shadowMap.enabled=!0}},o.a.createElement(Oe,null),o.a.createElement(r.Suspense,{fallback:o.a.createElement("mesh",null,o.a.createElement("boxBufferGeometry",{attach:"geometry",args:[.5,.5,.5]}),o.a.createElement("meshStandardMaterial",{attach:"material",color:"red"}))},e.map((function(e){var t=e.type,n=e.id,a=e.xy,r=e.elevation,c=e.rotation,i=J(t).Component3d;return o.a.createElement(i,{xy:a,rotation:c,elevation:r,key:n})})))))},ye=function(){return o.a.createElement(u.a,{store:pe},o.a.createElement(Ee,null))};n(83);i.a.render(o.a.createElement(ye,null),document.getElementById("root"))}},[[73,1,2]]]);
//# sourceMappingURL=main.428bfdfe.chunk.js.map