(this["webpackJsonpalpha-mechanical"]=this["webpackJsonpalpha-mechanical"]||[]).push([[0],{73:function(e,t,n){e.exports=n(84)},83:function(e,t,n){},84:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(22),i=n.n(c),u=n(33),s=n(23),l=n(62),d=n(88),f=n(5),b=n(14),p=n(8),m=n(63),h=n.n(m),j=n(64),v=n(6),O=function(e,t){return e.find((function(e){return e.id===t}))},g=function(e,t){return e.filter((function(e){return function(e,t){var n=Object(v.a)(e,2),a=n[0],r=n[1],o=Object(v.a)(t,2),c=o[0],i=o[1];return a===c&&r===i}(e.xy,t)}))},w=function(e){return Array.isArray(e)?e:[e]},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(f.a)(e),Object(f.a)(w(t)))},y=n(2),I=n(10);!function(e){e.Grass="Grass",e.Ice="Ice",e.RockFloor="RockFloor",e.Button="Button",e.Player="Player",e.BigRock="BigRock",e.Cannon="Cannon"}(a||(a={}));var S,C,q=n(13),k=n(50),x=n(1),_=n(56),A=function(e){return o.a.createElement(M,Object.assign({},e,{url:"rock1.gltf"}))},M=function(e){var t=e.url,n=e.instance,a=n.xy,r=n.elevation,c=n.rotation,i=e.castShadow,u=void 0===i||i,s=e.receiveShadow,l=void 0===s||s,d=Object(q.f)(k.a,"".concat("/alpha-mechanical","/assets/").concat(t));return u&&(d.scene.children[0].castShadow=!0),l&&(d.scene.children[0].receiveShadow=!0),d.scene.scale.set(.5,.5,.5),d.scene=d.scene.clone(),o.a.createElement("primitive",{object:d.scene,dispose:null,position:[a[0],r,a[1]],rotation:[0,B(c),0]})},R=function(e){var t=e.url,n=e.instance,a=n.xy,r=n.elevation,c=n.rotation,i=e.castShadow,u=void 0===i||i,s=e.receiveShadow,l=void 0===s||s,d=Object(_.b)({pos:[a[0],r,a[1]],rot:[0,B(c),0]}),f=Object(q.f)(k.a,"".concat("/alpha-mechanical","/assets/").concat(t)),b=Object(q.f)(k.a,"".concat("/alpha-mechanical","/assets/animations/boring.gltf"));u&&(f.scene.children[0].castShadow=!0),l&&(f.scene.children[0].receiveShadow=!0),f.scene.scale.set(.5,.5,.5),f.scene=f.scene.clone();var p=new x.AnimationMixer(b.scene);return b.animations.forEach((function(e){p.clipAction(e,f.scene.children[0]).play()})),Object(q.e)((function(){p.update(.02)})),o.a.createElement(_.a.primitive,{object:f.scene,dispose:null,position:d.pos,rotation:d.rot})},B=function(e){return 1===e[0]&&0===e[1]?Math.PI/2:0===e[0]&&-1===e[1]?Math.PI/2*2:-1===e[0]&&0===e[1]?Math.PI/2*3:0===e[0]&&1===e[1]?Math.PI/2*4:0},P=[0,-1],T=[1,0],z=[0,1],G=[-1,0],N=function(e){return function(t){return o.a.createElement("div",Object.assign({style:{width:"100%",height:"100%",backgroundColor:e,fontSize:9}},t))}},D=(S={},Object(y.a)(S,a.Grass,{name:"Grass",getId:function(){return Object(I.uniqueId)("grass")},canEnter:function(){return!0},Component:N("green"),Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"grass_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.Ice,{name:"Ice",getId:function(){return Object(I.uniqueId)("ice")},canEnter:function(){return!0},enter:function(e){var t=e.who,n=e.vector;return[ne({targetId:t.id,vector:n})]},Component:N("lightblue"),Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"ice_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.RockFloor,{name:"Rock floor",getId:function(){return Object(I.uniqueId)("rock-floor")},canEnter:function(){return!1},Component:N("gray"),Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"ground_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(y.a)(S,a.Button,{name:"Button",getId:function(){return Object(I.uniqueId)("button")},canEnter:function(){return!1},push:function(e){var t=e.state,n=Object(I.sample)(t.objects.filter((function(e){return"player"!==e.id})));return n?[re(n.id)]:[]},Component:N("blue"),Component3d:function(e){return o.a.createElement(M,Object.assign({},e,{url:"ground_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),S),F=function(e){return function(t){var n=t.instance,r=t.children;return o.a.createElement("div",{style:{margin:"20%",width:"60%",height:"60%",borderRadius:n.type===a.Player?100:5,backgroundColor:e,color:"black",opacity:.7}},o.a.createElement("pre",{style:{padding:2,fontSize:8}},r))}},L=(C={},Object(y.a)(C,a.Player,{name:"Player",getId:function(){return"player"},canEnter:function(){return!0},Component:F("white"),Component3d:function(e){return o.a.createElement(R,Object.assign({},e,{url:"robot_model.gltf"}))}}),Object(y.a)(C,a.BigRock,{name:"Big rock",getId:function(){return Object(I.uniqueId)("big-rock")},canEnter:function(){return!1},push:function(e){var t=e.self;return[ce({targetId:t.id,data:{info:Object(I.uniqueId)("Too big! ")}})]},Component:F("brown"),Component3d:A}),Object(y.a)(C,a.Cannon,{name:"Cannon",getId:function(){return Object(I.uniqueId)("cannon")},canEnter:function(){return!0},equip:function(e){var t=e.who,n=e.self;return[ce({targetId:t.id,data:{gun:"cannon"}}),re(n.id)]},Component:F("red"),Component3d:A}),C),U={0:a.Grass,1:a.RockFloor,2:a.Button,3:a.Ice},J=[[1,1,1,1,2,1,1],[1,0,3,3,0,0,1],[1,0,0,1,1,0,1],[1,0,0,1,0,0,1],[1,1,1,1,1,1,1]],Q={1:a.Player,2:a.BigRock,3:a.Cannon},H=[[0,0,0,0,0,0,0],[0,1,0,0,0,0,0],[0,0,0,0,0,0,0],[0,2,0,0,3,0,2],[0,0,0,0,0,0,0]],V=Object(p.a)({},D,{},L),W=function(e){var t=V[e];if(!t)throw new Error("[getDefinition] Definition for ".concat(e," not found"));return t},X=function(e,t,n){var a=e.objects,r=[],o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.push.apply(r,Object(f.a)(w(e)))},c={objects:a,actions:r},i=O(a,t);if(!i)return console.warn("[move] Target ".concat(t," not found")),c;var u=function(e,t){var n=Object(v.a)(e,2),a=n[0],r=n[1],o=Object(v.a)(t,2);return[a+o[0],r+o[1]]}(i.xy,n),s=g(a,u).sort((function(e,t){return t.aIndex-e.aIndex}));if(!s.length)return c;var l,d=Object(b.a)(s);try{for(d.s();!(l=d.n()).done;){var m,h=l.value,j=W(h.type),E={who:i,vector:n,state:e,self:h};if(!j.canEnter(E))return o(null===(m=j.push)||void 0===m?void 0:m.call(j,E)),{objects:a,actions:r}}}catch(x){d.e(x)}finally{d.f()}var y,I=Object(b.a)(s);try{for(I.s();!(y=I.n()).done;){var S,C=y.value,q=W(C.type),k={who:i,vector:n,state:e,self:C};o(null===(S=q.enter)||void 0===S?void 0:S.call(q,k))}}catch(x){I.e(x)}finally{I.f()}return{objects:a=a.map((function(e){return e!==i?e:Object(p.a)({},e,{xy:u})})),actions:r}},Y={queueStared:!1,queue:[],objects:function(){var e=J.flatMap((function(e,t){return e.map((function(e,n){var a=U[e];return{type:a,xy:[n,t],id:D[a].getId(),elevation:Math.random()/7,rotation:[0,0],zIndex:1,aIndex:100,data:{}}}))})),t=H.flatMap((function(t,n){return t.map((function(t,a){var r,o=Q[t];if(o)return{type:o,xy:[a,n],id:L[o].getId(),elevation:(null===(r=g(e,[a,n])[0])||void 0===r?void 0:r.elevation)||0,rotation:[0,0],zIndex:2,aIndex:10,data:{}}}))})).filter((function(e){return e}));return[].concat(Object(f.a)(t),Object(f.a)(e))}()},K=h()("GAME"),Z=K("ENQUEUE"),$=K("TRY_NEXT_ACTION"),ee=K("NEXT_ACTION"),te=K("QUEUE_END"),ne=K("MOVE"),ae=K("ROTATE"),re=K("REMOVE"),oe=K("EQUIP"),ce=K("SET_OBJECT_DATA"),ie=Object(j.reducerWithInitialState)(Y).case(Z,(function(e,t){return Object(p.a)({},e,{queue:E(e.queue,t)})})).case(ee,(function(e,t){return Object(p.a)({},e,{queueStared:!0,queue:e.queue.filter((function(e){return e!==t}))})})).case(te,(function(e){return Object(p.a)({},e,{queueStared:!1})})).case(ne,(function(e,t){var n=t.targetId,a=t.vector,r=X(e,n,a),o=r.actions,c=r.objects;return Object(p.a)({},e,{objects:c,queue:E(e.queue,o)})})).case(ae,(function(e,t){var n=function(e,t,n){var a=e.objects,r=O(a,t);return{objects:a.map((function(e){return e!==r?e:Object(p.a)({},e,{rotation:n})})),actions:[]}}(e,t.targetId,t.rotation),a=n.actions,r=n.objects;return Object(p.a)({},e,{objects:r,queue:E(e.queue,a)})})).case(re,(function(e,t){return Object(p.a)({},e,{objects:e.objects.filter((function(e){return e.id!==t}))})})).case(oe,(function(e,t){var n=t.targetId,a=ue(e,n),r=a.actions,o=a.objects;return Object(p.a)({},e,{objects:o,queue:E(e.queue,r)})})).case(ce,(function(e,t){var n=t.targetId,a=t.data,r=se(e,n,a),o=r.actions,c=r.objects;return Object(p.a)({},e,{objects:c,queue:E(e.queue,o)})})),ue=function(e,t){var n=[],a=O(e.objects,t);if(!a)return{objects:e.objects,actions:[]};var r,o=g(e.objects,a.xy).sort((function(e,t){return t.aIndex-e.aIndex})),c=Object(b.a)(o);try{for(c.s();!(r=c.n()).done;){var i,u=r.value,s=W(u.type),l={who:a,vector:[0,0],state:e,self:u};n.push.apply(n,Object(f.a)((null===(i=s.equip)||void 0===i?void 0:i.call(s,l))||[]))}}catch(d){c.e(d)}finally{c.f()}return{actions:n,objects:e.objects}},se=function(e,t,n){var a=e.objects,r=O(a,t);return{objects:a.map((function(e){return e!==r?e:Object(p.a)({},e,{data:Object(p.a)({},e.data,{},n)})})),actions:[]}},le=n(90),de=n(91),fe=n(45),be=n(86),pe=n(87),me=n(69),he=n(71),je=n(89),ve=Object(le.a)((function(e,t){return e.pipe(Object(be.a)(Z.match),Object(be.a)((function(){return!t.value.game.queueStared})),Object(pe.a)($()))}),(function(e,t){return e.pipe(Object(be.a)($.match),Object(me.a)((function(){return Object(I.first)(t.value.game.queue)})),Object(me.a)((function(e){return e?ee(e):te()})))}),(function(e,t){return e.pipe(Object(be.a)(ee.match),Object(he.a)((function(e){var t;return Object(de.a)(Object(fe.a)(e.payload),Object(fe.a)($()).pipe(Object(je.a)((null===(t=e.meta)||void 0===t?void 0:t.delay)||50)))})))})),Oe=Object(d.a)(),ge=Object(l.composeWithDevTools)({name:"App"}),we=Object(s.combineReducers)({game:ie}),Ee=Object(s.createStore)(we,ge(Object(s.applyMiddleware)(Oe)));Oe.run(ve);var ye=function(){var e=Object(u.c)((function(e){return e.game})),t=Object(u.b)();return Object(p.a)({},e,{move:function(n){if(!e.queueStared){var a=[],r=O(e.objects,"player");if(!r)return console.warn("Player don't exists [".concat("player","]"));Object(I.isEqual)(r.rotation,n)?a.push(ne({targetId:"player",vector:n})):a.push(ae({targetId:"player",rotation:n})),t(Z(a))}},equip:function(){t(Z(oe({targetId:"player"})))}})},Ie=function(e,t){Object(r.useEffect)((function(){var n=function(n){n.key===e&&t()};return window.addEventListener("keydown",n),function(){return window.removeEventListener("keydown",n)}}))},Se=function(e){var t=e.objects,n=ye(),a=n.move,r=n.equip,c=function(){return a(G)},i=function(){return a(P)},u=function(){return a(z)},s=function(){return a(T)};return Ie("ArrowLeft",c),Ie("ArrowUp",i),Ie("ArrowDown",u),Ie("ArrowRight",s),Ie(" ",r),o.a.createElement("div",{style:{position:"absolute",zIndex:100,top:0,right:0,width:480,opacity:.8}},o.a.createElement("button",{onClick:c},"\u2190"),o.a.createElement("button",{onClick:i},"\u2191"),o.a.createElement("button",{onClick:u},"\u2193"),o.a.createElement("button",{onClick:s},"\u2192"),o.a.createElement("button",{onClick:r},"equip"),o.a.createElement("div",{style:{position:"relative"}},t.map((function(e){var t=e.type,n=e.id,a=e.xy,r=(e.rotation,e.elevation,e.zIndex),c=e.data,i=W(t).Component;return o.a.createElement("div",{key:n,style:{position:"absolute",left:60*a[0],top:60*a[1],width:60,height:60,zIndex:r}},o.a.createElement(i,{instance:e},t," ",o.a.createElement("br",null),Object(I.isEmpty)(c)?"":JSON.stringify(c,null,1)))}))))},Ce=function(){return o.a.createElement("group",null,o.a.createElement("ambientLight",{intensity:2}),o.a.createElement("pointLight",{position:[6,7,8],intensity:2.2,color:new x.Color("#3a8dc2"),"shadow-mapSize-Height":"1024","shadow-mapSize-width":"1024","shadow-camera-far":30,"shadow-bias":-.01,castShadow:!0,"shadow-camera-left":-5,"shadow-camera-right":5,"shadow-camera-top":5,"shadow-camera-bottom":-5}),o.a.createElement("pointLight",{position:[1,3,5],intensity:2.2,color:new x.Color("#c86b6f"),"shadow-mapSize-Height":"1024","shadow-mapSize-width":"1024","shadow-camera-far":30,"shadow-bias":-.01,castShadow:!0,"shadow-camera-left":-5,"shadow-camera-right":5,"shadow-camera-top":5,"shadow-camera-bottom":-5}))},qe=function(){var e=ye().objects;Object(q.g)().gl;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Se,{objects:e}),o.a.createElement(q.a,{orthographic:!0,camera:{zoom:100,fov:1075,position:[0,5,7]},onCreated:function(e){e.camera.lookAt(3,1,2),e.gl.shadowMap.type=x.PCFSoftShadowMap,e.gl.shadowMap.enabled=!0}},o.a.createElement(Ce,null),o.a.createElement(r.Suspense,{fallback:o.a.createElement("mesh",null,o.a.createElement("boxBufferGeometry",{attach:"geometry",args:[.5,.5,.5]}),o.a.createElement("meshStandardMaterial",{attach:"material",color:"red"}))},e.map((function(e){var t=W(e.type).Component3d;return o.a.createElement(t,{key:e.id,instance:e})})))))},ke=function(){return o.a.createElement(u.a,{store:Ee},o.a.createElement(qe,null))};n(83);i.a.render(o.a.createElement(ke,null),document.getElementById("root"))}},[[73,1,2]]]);
//# sourceMappingURL=main.a3f67a8b.chunk.js.map