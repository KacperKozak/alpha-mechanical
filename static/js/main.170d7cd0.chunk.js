(this["webpackJsonpalpha-mechanical"]=this["webpackJsonpalpha-mechanical"]||[]).push([[0],{74:function(e,t,n){e.exports=n(85)},84:function(e,t,n){},85:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(23),i=n.n(c),u=n(34),s=n(24),l=n(64),d=n(91),f=n(93),b=n(94),p=n(46),m=n(87),j=n(88),h=n(71),v=n(73),O=n(92),g=n(6),E=n(14),y=n(8),w=n(65),I=n.n(w),S=n(66),q=n(7),C=function(e,t){return e.find((function(e){return e.id===t}))},k=function(e,t){return e.filter((function(e){return function(e,t){var n=Object(q.a)(e,2),a=n[0],r=n[1],o=Object(q.a)(t,2),c=o[0],i=o[1];return a===c&&r===i}(e.xy,t)}))},x=function(e){return Array.isArray(e)?e:[e]},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(g.a)(e),Object(g.a)(x(t)))},A=n(2),M=n(10);!function(e){e.Grass="Grass",e.Ice="Ice",e.RockFloor="RockFloor",e.Button="Button",e.Player="Player",e.BigRock="BigRock",e.Cannon="Cannon"}(a||(a={}));var R,B,P=n(13),T=n(51),G=n(1),z=n(58),N=function(e){return o.a.createElement(U,Object.assign({},e,{url:"rock1.gltf"}))},U=function(e){var t=e.url,n=e.instance,a=n.xy,r=n.elevation,c=n.rotation,i=e.castShadow,u=void 0===i||i,s=e.receiveShadow,l=void 0===s||s,d=Object(P.f)(T.a,"".concat("/alpha-mechanical","/assets/").concat(t));return u&&(d.scene.children[0].castShadow=!0),l&&(d.scene.children[0].receiveShadow=!0),d.scene.scale.set(.5,.5,.5),d.scene=d.scene.clone(),o.a.createElement("primitive",{object:d.scene,dispose:null,position:[a[0],r,a[1]],rotation:[0,F(c),0]})},D=function(e){var t=e.url,n=e.instance,a=n.xy,r=n.elevation,c=n.rotation,i=e.castShadow,u=void 0===i||i,s=e.receiveShadow,l=void 0===s||s,d=Object(z.b)({pos:[a[0],r,a[1]],rot:[0,F(c),0]}),f=Object(P.f)(T.a,"".concat("/alpha-mechanical","/assets/").concat(t)),b=Object(P.f)(T.a,"".concat("/alpha-mechanical","/assets/animations/boring.gltf"));u&&(f.scene.children[0].castShadow=!0),l&&(f.scene.children[0].receiveShadow=!0),f.scene.scale.set(.5,.5,.5),f.scene=f.scene.clone();var p=new G.AnimationMixer(b.scene);return b.animations.forEach((function(e){p.clipAction(e,f.scene.children[0]).play()})),Object(P.e)((function(){p.update(.02)})),o.a.createElement(z.a.primitive,{object:f.scene,dispose:null,position:d.pos,rotation:d.rot})},F=function(e){return 1===e[0]&&0===e[1]?Math.PI/2:0===e[0]&&-1===e[1]?Math.PI/2*2:-1===e[0]&&0===e[1]?Math.PI/2*3:0===e[0]&&1===e[1]?Math.PI/2*4:0},L=[0,-1],J=[1,0],Q=[0,1],V=[-1,0],W=function(e){return function(t){return o.a.createElement("div",Object.assign({style:{width:"100%",height:"100%",backgroundColor:e,fontSize:9}},t))}},X=(R={},Object(A.a)(R,a.Grass,{name:"Grass",isGround:!0,getId:function(){return Object(M.uniqueId)("grass")},canEnter:function(){return!0},Component:W("green"),Component3d:function(e){return o.a.createElement(U,Object.assign({},e,{url:"grass_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(A.a)(R,a.Ice,{name:"Ice",isGround:!0,getId:function(){return Object(M.uniqueId)("ice")},canEnter:function(){return!0},enter:function(e){var t=e.who,n=e.vector;return[fe({targetId:t.id,vector:n})]},Component:W("lightblue"),Component3d:function(e){return o.a.createElement(U,Object.assign({},e,{url:"ice_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(A.a)(R,a.RockFloor,{name:"Rock floor",isGround:!0,getId:function(){return Object(M.uniqueId)("rock-floor")},canEnter:function(){return!0},Component:W("gray"),Component3d:function(e){return o.a.createElement(U,Object.assign({},e,{url:"rock.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(A.a)(R,a.Button,{name:"Button",isGround:!0,getId:function(){return Object(M.uniqueId)("button")},canEnter:function(){return!1},push:function(e){var t=e.state,n=e.self,a=Object(M.sample)(t.objects.filter((function(e){return"player"!==e.id})));return a?[pe(a.id),je({targetId:n.id,data:{info:Object(M.uniqueId)("Ups!")}})]:[]},Component:W("blue"),Component3d:function(e){return o.a.createElement(U,Object.assign({},e,{url:"ground_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),R),H={equip3:"/sounds/Equip_3.mp3",engineStart:"/sounds/Engine_start.mp3",button:"/sounds/Button_gameplay.mp3",music:"/sounds/elementary1.mp3"},Y=function(e,t){var n=new Audio(H[e]);t&&(n.volume=t),n.play()},K=function(e){return function(t){var n=t.instance,r=t.children;return o.a.createElement("div",{style:{margin:"20%",width:"60%",height:"60%",borderRadius:n.type===a.Player?100:5,backgroundColor:e,color:"black",opacity:.7}},o.a.createElement("pre",{style:{padding:2,fontSize:8}},r))}},Z=(B={},Object(A.a)(B,a.Player,{name:"Player",getId:function(){return"player"},canEnter:function(){return!0},Component:K("white"),Component3d:function(e){return o.a.createElement(D,Object.assign({},e,{url:"robot_model.gltf"}))}}),Object(A.a)(B,a.BigRock,{name:"Big rock",getId:function(){return Object(M.uniqueId)("big-rock")},canEnter:function(){return!1},push:function(e){var t=e.self,n=e.vector;return[fe({targetId:t.id,vector:n})]},Component:K("brown"),Component3d:N}),Object(A.a)(B,a.Cannon,{name:"Cannon",getId:function(){return Object(M.uniqueId)("cannon")},canEnter:function(){return!0},equip:function(e){var t=e.who,n=e.self;return Y("equip3"),[je({targetId:t.id,data:{gun:"cannon"}}),pe(n.id)]},Component:K("red"),Component3d:N}),B),$={0:a.Grass,1:a.RockFloor,2:a.Button,3:a.Ice},ee=[[1,1,1,1,2,1,1],[1,0,3,3,0,0,1],[1,0,0,1,1,0,1],[1,0,0,1,0,0,1],[1,1,1,1,1,1,1]],te={1:a.Player,2:a.BigRock,3:a.Cannon},ne=[[0,0,0,0,0,0,0],[0,1,0,0,0,0,0],[0,0,0,0,0,0,0],[0,2,0,0,3,0,2],[0,0,0,0,0,0,0]],ae=Object(y.a)({},X,{},Z),re=function(e){var t=ae[e];if(!t)throw new Error("[getDefinition] Definition for ".concat(e," not found"));return t},oe=function(e,t,n){var a=e.objects,r=[],o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r.push.apply(r,Object(g.a)(x(e)))},c={objects:a,actions:r},i=C(a,t);if(!i)return console.warn("[move] Target ".concat(t," not found")),c;var u=function(e,t){var n=Object(q.a)(e,2),a=n[0],r=n[1],o=Object(q.a)(t,2);return[a+o[0],r+o[1]]}(i.xy,n),s=k(a,u).sort((function(e,t){return t.aIndex-e.aIndex}));if(!s.length)return c;var l,d=Object(E.a)(s);try{for(d.s();!(l=d.n()).done;){var f,b=l.value,p=re(b.type),m={who:i,vector:n,state:e,self:b};if(!p.canEnter(m))return o(null===(f=p.push)||void 0===f?void 0:f.call(p,m)),{objects:a,actions:r}}}catch(S){d.e(S)}finally{d.f()}var j,h=Object(E.a)(s);try{for(h.s();!(j=h.n()).done;){var v,O=j.value,w=re(O.type),I={who:i,vector:n,state:e,self:O};o(null===(v=w.enter)||void 0===v?void 0:v.call(w,I))}}catch(S){h.e(S)}finally{h.f()}return{objects:a=a.map((function(e){return e!==i?e:Object(y.a)({},e,{xy:u})})),actions:r}},ce={queueStared:!1,queue:[],objects:function(){var e=ee.flatMap((function(e,t){return e.map((function(e,n){var a=$[e];return{type:a,xy:[n,t],id:X[a].getId(),elevation:Math.random()/2,rotation:[0,0],zIndex:1,aIndex:100,data:{}}}))})),t=ne.flatMap((function(t,n){return t.map((function(t,a){var r,o=te[t];if(o)return{type:o,xy:[a,n],id:Z[o].getId(),elevation:(null===(r=k(e,[a,n])[0])||void 0===r?void 0:r.elevation)||0,rotation:[0,0],zIndex:2,aIndex:10,data:{}}}))})).filter((function(e){return e}));return[].concat(Object(g.a)(t),Object(g.a)(e))}()},ie=I()("GAME"),ue=ie("ENQUEUE"),se=ie("TRY_NEXT_ACTION"),le=ie("NEXT_ACTION"),de=ie("QUEUE_END"),fe=ie("MOVE"),be=ie("ROTATE"),pe=ie("REMOVE"),me=ie("EQUIP"),je=ie("SET_OBJECT_DATA"),he=Object(S.reducerWithInitialState)(ce).case(ue,(function(e,t){return Object(y.a)({},e,{queue:_(e.queue,t)})})).case(le,(function(e,t){return Object(y.a)({},e,{queueStared:!0,queue:e.queue.filter((function(e){return e!==t}))})})).case(de,(function(e){return Object(y.a)({},e,{queueStared:!1})})).case(fe,(function(e,t){var n=t.targetId,a=t.vector,r=oe(e,n,a),o=r.actions,c=r.objects;return Object(y.a)({},e,{objects:c,queue:_(e.queue,o)})})).case(be,(function(e,t){var n=function(e,t,n){var a=e.objects,r=C(a,t);return{objects:a.map((function(e){return e!==r?e:Object(y.a)({},e,{rotation:n})})),actions:[]}}(e,t.targetId,t.rotation),a=n.actions,r=n.objects;return Object(y.a)({},e,{objects:r,queue:_(e.queue,a)})})).case(pe,(function(e,t){return Object(y.a)({},e,{objects:e.objects.filter((function(e){return e.id!==t}))})})).case(me,(function(e,t){var n=t.targetId,a=ve(e,n),r=a.actions,o=a.objects;return Object(y.a)({},e,{objects:o,queue:_(e.queue,r)})})).case(je,(function(e,t){var n=t.targetId,a=t.data,r=Oe(e,n,a),o=r.actions,c=r.objects;return Object(y.a)({},e,{objects:c,queue:_(e.queue,o)})})),ve=function(e,t){var n=[],a=C(e.objects,t);if(!a)return{objects:e.objects,actions:[]};var r,o=k(e.objects,a.xy).sort((function(e,t){return t.aIndex-e.aIndex})),c=Object(E.a)(o);try{for(c.s();!(r=c.n()).done;){var i,u=r.value,s=re(u.type),l={who:a,vector:[0,0],state:e,self:u};n.push.apply(n,Object(g.a)((null===(i=s.equip)||void 0===i?void 0:i.call(s,l))||[]))}}catch(d){c.e(d)}finally{c.f()}return{actions:n,objects:e.objects}},Oe=function(e,t,n){var a=e.objects,r=C(a,t);return{objects:a.map((function(e){return e!==r?e:Object(y.a)({},e,{data:Object(y.a)({},e.data,{},n)})})),actions:[]}},ge=Object(f.a)((function(e,t){return e.pipe(Object(m.a)(ue.match),Object(m.a)((function(){return!t.value.game.queueStared})),Object(j.a)(se()))}),(function(e,t){return e.pipe(Object(m.a)(se.match),Object(h.a)((function(){return Object(M.first)(t.value.game.queue)})),Object(h.a)((function(e){return e?le(e):de()})))}),(function(e,t){return e.pipe(Object(m.a)(le.match),Object(v.a)((function(e){var t;return Object(b.a)(Object(p.a)(e.payload),Object(p.a)(se()).pipe(Object(O.a)((null===(t=e.meta)||void 0===t?void 0:t.delay)||50)))})))})),Ee=n(89),ye=n(90),we=Object(f.a)((function(e){return e.pipe(Object(m.a)(fe.match),Object(Ee.a)((function(){return Y("engineStart",.2)})),Object(ye.a)())}),(function(e){return e.pipe(Object(m.a)(me.match),Object(Ee.a)((function(){return Y("button")})),Object(ye.a)())})),Ie=Object(d.a)(),Se=Object(l.composeWithDevTools)({name:"App"}),qe=Object(s.combineReducers)({game:he}),Ce=Object(s.createStore)(qe,Se(Object(s.applyMiddleware)(Ie)));Ie.run(Object(f.a)(we,ge));var ke=function(){var e=Object(u.c)((function(e){return e.game})),t=Object(u.b)();return Object(y.a)({},e,{move:function(n){if(!e.queueStared){var a=[],r=C(e.objects,"player");if(!r)return console.warn("Player don't exists [".concat("player","]"));Object(M.isEqual)(r.rotation,n)?a.push(fe({targetId:"player",vector:n})):a.push(be({targetId:"player",rotation:n})),t(ue(a))}},equip:function(){t(ue(me({targetId:"player"})))}})},xe=function(e,t){Object(r.useEffect)((function(){var n=function(n){n.key===e&&t()};return window.addEventListener("keydown",n),function(){return window.removeEventListener("keydown",n)}}))},_e=function(e){var t=e.objects,n=ke(),a=n.move,r=n.equip,c=function(){return a(V)},i=function(){return a(L)},u=function(){return a(Q)},s=function(){return a(J)};return xe("ArrowLeft",c),xe("ArrowUp",i),xe("ArrowDown",u),xe("ArrowRight",s),xe("Enter",r),o.a.createElement("div",{style:{position:"absolute",zIndex:100,top:0,right:0,width:480,opacity:.8}},o.a.createElement("button",{onClick:c},"\u2190"),o.a.createElement("button",{onClick:i},"\u2191"),o.a.createElement("button",{onClick:u},"\u2193"),o.a.createElement("button",{onClick:s},"\u2192"),o.a.createElement("button",{onClick:r},"equip"),o.a.createElement("div",{style:{position:"relative"}},t.map((function(e){var t=e.type,n=e.id,a=e.xy,r=(e.rotation,e.elevation,e.zIndex),c=e.data,i=re(t).Component;return o.a.createElement("div",{key:n,style:{position:"absolute",left:60*a[0],top:60*a[1],width:60,height:60,zIndex:r}},o.a.createElement(i,{instance:e},t," ",o.a.createElement("br",null),Object(M.isEmpty)(c)?"":JSON.stringify(c,null,1)))}))))},Ae=function(){return o.a.createElement("group",null,o.a.createElement("ambientLight",{intensity:2}),o.a.createElement("pointLight",{position:[6,7,8],intensity:2.2,color:new G.Color("#3a8dc2"),"shadow-mapSize-Height":"1024","shadow-mapSize-width":"1024","shadow-camera-far":30,"shadow-bias":-.01,castShadow:!0,"shadow-camera-left":-5,"shadow-camera-right":5,"shadow-camera-top":5,"shadow-camera-bottom":-5}),o.a.createElement("pointLight",{position:[1,3,5],intensity:2.2,color:new G.Color("#c86b6f")}))},Me=function(){var e=ke().objects;Object(P.g)().gl;return o.a.createElement(o.a.Fragment,null,o.a.createElement(_e,{objects:e}),o.a.createElement(P.a,{orthographic:!0,camera:{zoom:100,fov:1075,position:[1,7,7]},onCreated:function(e){e.camera.lookAt(3,1,2),e.gl.shadowMap.type=G.PCFSoftShadowMap,e.gl.shadowMap.enabled=!0}},o.a.createElement(Ae,null),o.a.createElement(r.Suspense,{fallback:o.a.createElement("mesh",null,o.a.createElement("boxBufferGeometry",{attach:"geometry",args:[.5,.5,.5]}),o.a.createElement("meshStandardMaterial",{attach:"material",color:"red"}))},e.map((function(e){var t=re(e.type).Component3d;return o.a.createElement(t,{key:e.id,instance:e})})))))},Re=function(){return o.a.createElement(u.a,{store:Ce},o.a.createElement(Me,null))};n(84);i.a.render(o.a.createElement(Re,null),document.getElementById("root"))}},[[74,1,2]]]);
//# sourceMappingURL=main.170d7cd0.chunk.js.map