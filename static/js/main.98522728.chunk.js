(this["webpackJsonpalpha-mechanical"]=this["webpackJsonpalpha-mechanical"]||[]).push([[0],{74:function(e,t,n){e.exports=n(85)},84:function(e,t,n){},85:function(e,t,n){"use strict";n.r(t);var a,o=n(0),c=n.n(o),r=n(23),i=n.n(r),u=n(34),l=n(24),s=n(64),d=n(91),p=n(93),f=n(94),m=n(46),h=n(87),b=n(88),j=n(71),v=n(73),O=n(92),g=n(6),E=n(14),y=n(8),w=n(65),_=n.n(w),I=n(66),q=n(7),C=function(e,t){return e.find((function(e){return e.id===t}))},S=function(e,t){return e.filter((function(e){return function(e,t){var n=Object(q.a)(e,2),a=n[0],o=n[1],c=Object(q.a)(t,2),r=c[0],i=c[1];return a===r&&o===i}(e.xy,t)}))},k=function(e){return Array.isArray(e)?e:[e]},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(Object(g.a)(e),Object(g.a)(k(t)))},A=n(2),M=n(10);!function(e){e.Grass="Grass",e.Ice="Ice",e.RockFloor="RockFloor",e.Button="Button",e.Player="Player",e.BigRock="BigRock",e.Cannon="Cannon"}(a||(a={}));var B,P,R=n(13),N=n(51),z=n(1),T=n(58),L=function(e){return c.a.createElement(G,Object.assign({},e,{url:"rock1.gltf"}))},G=function(e){var t=e.url,n=e.instance,a=n.xy,o=n.elevation,r=n.rotation,i=e.castShadow,u=void 0===i||i,l=e.receiveShadow,s=void 0===l||l,d=Object(R.f)(N.a,"".concat("/alpha-mechanical","/assets/").concat(t));return u&&(d.scene.children[0].castShadow=!0),s&&(d.scene.children[0].receiveShadow=!0),d.scene.scale.set(.5,.5,.5),d.scene=d.scene.clone(),c.a.createElement("primitive",{object:d.scene,dispose:null,position:[a[0],o,a[1]],rotation:[0,D(r),0]})},U=function(e){var t=e.url,n=e.instance,a=n.xy,o=n.elevation,r=n.rotation,i=e.castShadow,u=void 0===i||i,l=e.receiveShadow,s=void 0===l||l,d=Object(T.b)({pos:[a[0],o,a[1]],rot:[0,D(r),0]}),p=Object(R.f)(N.a,"".concat("/alpha-mechanical","/assets/").concat(t)),f=Object(R.f)(N.a,"".concat("/alpha-mechanical","/assets/animations/boring.gltf"));u&&(p.scene.children[0].castShadow=!0),s&&(p.scene.children[0].receiveShadow=!0),p.scene.scale.set(.5,.5,.5),p.scene=p.scene.clone();var m=new z.AnimationMixer(f.scene);return f.animations.forEach((function(e){m.clipAction(e,p.scene.children[0]).play()})),Object(R.e)((function(){m.update(.02)})),c.a.createElement(T.a.primitive,{object:p.scene,dispose:null,position:d.pos,rotation:d.rot})},D=function(e){return 1===e[0]&&0===e[1]?Math.PI/2:0===e[0]&&-1===e[1]?Math.PI/2*2:-1===e[0]&&0===e[1]?Math.PI/2*3:0===e[0]&&1===e[1]?Math.PI/2*4:0},F=[0,-1],H=[1,0],J=[0,1],Q=[-1,0],Y={button:"".concat("/alpha-mechanical","/sounds/Button_gameplay.mp3"),music:"".concat("/alpha-mechanical","/sounds/elementary1.mp3"),Alert_NO:"".concat("/alpha-mechanical","/sounds/Alert_NO.mp3"),Alert_YES:"".concat("/alpha-mechanical","/sounds/Alert_YES.mp3"),Bazooka:"".concat("/alpha-mechanical","/sounds/Bazooka.mp3"),Crossbow:"".concat("/alpha-mechanical","/sounds/Crossbow.mp3"),Engine_start:"".concat("/alpha-mechanical","/sounds/Engine_start.mp3"),Engine_LOOP_128:"".concat("/alpha-mechanical","/sounds/Engine_LOOP_128.mp3"),Engine_NO_1:"".concat("/alpha-mechanical","/sounds/Engine_NO_1.mp3"),Engine_NO_2:"".concat("/alpha-mechanical","/sounds/Engine_NO_2.mp3"),Engine_stop:"".concat("/alpha-mechanical","/sounds/Engine_stop.mp3"),Equip_1:"".concat("/alpha-mechanical","/sounds/Equip_1.mp3"),Equip_2:"".concat("/alpha-mechanical","/sounds/Equip_2.mp3"),Equip_3:"".concat("/alpha-mechanical","/sounds/Equip_3.mp3"),Equip_4:"".concat("/alpha-mechanical","/sounds/Equip_4.mp3"),Hero_1:"".concat("/alpha-mechanical","/sounds/Hero_1.mp3"),Hero_2:"".concat("/alpha-mechanical","/sounds/Hero_2.mp3"),Jump:"".concat("/alpha-mechanical","/sounds/Jump.mp3")},V=function(e,t){var n=new Audio(Y[e]);t&&(n.volume=t),n.play()},W=new Audio(Y.Engine_LOOP_128),X=function(e){return function(t){return c.a.createElement("div",Object.assign({style:{width:"100%",height:"100%",backgroundColor:e,fontSize:9}},t))}},K=(B={},Object(A.a)(B,a.Grass,{name:"Grass",height:0,getId:function(){return Object(M.uniqueId)("grass")},Component:X("green"),Component3d:function(e){return c.a.createElement(G,Object.assign({},e,{url:"grass_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(A.a)(B,a.Ice,{name:"Ice",height:0,getId:function(){return Object(M.uniqueId)("ice")},enter:function(e){var t=e.who,n=e.vector;return[me({targetId:t.id,vector:n})]},Component:X("lightblue"),Component3d:function(e){return c.a.createElement(G,Object.assign({},e,{url:"ice_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(A.a)(B,a.RockFloor,{name:"Rock floor",height:0,getId:function(){return Object(M.uniqueId)("rock-floor")},Component:X("gray"),Component3d:function(e){return c.a.createElement(G,Object.assign({},e,{url:"rock.gltf",castShadow:!1,receiveShadow:!0}))}}),Object(A.a)(B,a.Button,{name:"Button",height:0,getId:function(){return Object(M.uniqueId)("button")},push:function(e){var t=e.state,n=e.self,a=Object(M.sample)(t.objects.filter((function(e){return"player"!==e.id})));return V("button"),a?[be(a.id),ve({targetId:n.id,data:{info:Object(M.uniqueId)("Ups!")}})]:[]},Component:X("blue"),Component3d:function(e){return c.a.createElement(G,Object.assign({},e,{url:"ground_002_export_test_1_cube.gltf",castShadow:!1,receiveShadow:!0}))}}),B),Z=function(e){return function(t){var n=t.instance,o=t.children;return c.a.createElement("div",{style:{margin:"20%",width:"60%",height:"60%",borderRadius:n.type===a.Player?100:5,backgroundColor:e,color:"black",opacity:.7}},c.a.createElement("pre",{style:{padding:2,fontSize:8}},o))}},$=(P={},Object(A.a)(P,a.Player,{name:"Player",height:2,getId:function(){return"player"},Component:Z("white"),Component3d:function(e){return c.a.createElement(U,Object.assign({},e,{url:"robot_model.gltf"}))}}),Object(A.a)(P,a.BigRock,{name:"Big rock",height:.5,getId:function(){return Object(M.uniqueId)("big-rock")},push:function(e){var t=e.self,n=e.vector;return[me({targetId:t.id,vector:n})]},Component:Z("brown"),Component3d:L}),Object(A.a)(P,a.Cannon,{name:"Cannon",height:0,getId:function(){return Object(M.uniqueId)("cannon")},equip:function(e){var t,n=e.who,a=e.self;return t=.8,V(["Equip_1","Equip_2","Equip_3","Equip_4"][Math.round(4*Math.random())],t),[ve({targetId:n.id,data:{gun:"cannon"}}),be(a.id)]},Component:Z("red"),Component3d:L}),P),ee={0:a.Grass,1:a.RockFloor,2:a.Button,3:a.Ice},te=[[1,1,1,1,2,1,1],[1,0,3,3,0,0,1],[1,0,0,1,1,0,1],[1,0,0,1,0,0,1],[1,1,1,1,1,1,1]],ne={1:a.Player,2:a.BigRock,3:a.Cannon},ae=[[0,0,0,0,0,0,0],[0,1,0,0,0,0,0],[0,0,0,0,0,0,0],[0,2,0,0,3,0,2],[0,0,0,0,0,0,0]],oe=Object(y.a)({},K,{},$),ce=function(e){var t=oe[e];if(!t)throw new Error("[getDefinition] Definition for ".concat(e," not found"));return t},re=function(e,t,n){var a=e.objects,o=[],c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return o.push.apply(o,Object(g.a)(k(e)))},r={objects:a,actions:o},i=C(a,t);if(!i)return console.warn("[move] Target ".concat(t," not found")),r;var u=function(e,t){var n=Object(q.a)(e,2),a=n[0],o=n[1],c=Object(q.a)(t,2);return[a+c[0],o+c[1]]}(i.xy,n),l=S(a,u).sort((function(e,t){return t.aIndex-e.aIndex}));if(!l.length)return r;var s,d=Object(E.a)(l);try{for(d.s();!(s=d.n()).done;){var p,f=s.value,m=ce(f.type),h={who:i,vector:n,state:e,self:f};if(f.elevation+m.height-i.elevation>.5)return c(null===(p=m.push)||void 0===p?void 0:p.call(m,h)),{objects:a,actions:o}}}catch(I){d.e(I)}finally{d.f()}var b,j=Object(E.a)(l);try{for(j.s();!(b=j.n()).done;){var v,O=b.value,w=ce(O.type),_={who:i,vector:n,state:e,self:O};c(null===(v=w.enter)||void 0===v?void 0:v.call(w,_))}}catch(I){j.e(I)}finally{j.f()}return{objects:a=a.map((function(e){return e!==i?e:Object(y.a)({},e,{xy:u,elevation:ie(l)})})),actions:o}},ie=function(e){return Math.max.apply(Math,Object(g.a)(e.map((function(e){return ce(e.type).height+e.elevation}))))},ue={queueStared:!1,queue:[],objects:function(){var e=te.flatMap((function(e,t){return e.map((function(e,n){var a=ee[e];return{type:a,xy:[n,t],id:K[a].getId(),elevation:Math.random()/1.5,rotation:[0,0],zIndex:1,aIndex:100,data:{}}}))})),t=ae.flatMap((function(t,n){return t.map((function(t,a){var o,c=ne[t];if(c)return{type:c,xy:[a,n],id:$[c].getId(),elevation:(null===(o=S(e,[a,n])[0])||void 0===o?void 0:o.elevation)||0,rotation:[0,0],zIndex:2,aIndex:10,data:{}}}))})).filter((function(e){return e}));return[].concat(Object(g.a)(t),Object(g.a)(e))}()},le=_()("GAME"),se=le("ENQUEUE"),de=le("TRY_NEXT_ACTION"),pe=le("NEXT_ACTION"),fe=le("QUEUE_END"),me=le("MOVE"),he=le("ROTATE"),be=le("REMOVE"),je=le("EQUIP"),ve=le("SET_OBJECT_DATA"),Oe=Object(I.reducerWithInitialState)(ue).case(se,(function(e,t){return Object(y.a)({},e,{queue:x(e.queue,t)})})).case(pe,(function(e,t){return Object(y.a)({},e,{queueStared:!0,queue:e.queue.filter((function(e){return e!==t}))})})).case(fe,(function(e){return Object(y.a)({},e,{queueStared:!1})})).case(me,(function(e,t){var n=t.targetId,a=t.vector,o=re(e,n,a),c=o.actions,r=o.objects;return Object(y.a)({},e,{objects:r,queue:x(e.queue,c)})})).case(he,(function(e,t){var n=function(e,t,n){var a=e.objects,o=C(a,t);return{objects:a.map((function(e){return e!==o?e:Object(y.a)({},e,{rotation:n})})),actions:[]}}(e,t.targetId,t.rotation),a=n.actions,o=n.objects;return Object(y.a)({},e,{objects:o,queue:x(e.queue,a)})})).case(be,(function(e,t){return Object(y.a)({},e,{objects:e.objects.filter((function(e){return e.id!==t}))})})).case(je,(function(e,t){var n=t.targetId,a=ge(e,n),o=a.actions,c=a.objects;return Object(y.a)({},e,{objects:c,queue:x(e.queue,o)})})).case(ve,(function(e,t){var n=t.targetId,a=t.data,o=Ee(e,n,a),c=o.actions,r=o.objects;return Object(y.a)({},e,{objects:r,queue:x(e.queue,c)})})),ge=function(e,t){var n=[],a=C(e.objects,t);if(!a)return{objects:e.objects,actions:[]};var o,c=S(e.objects,a.xy).sort((function(e,t){return t.aIndex-e.aIndex})),r=Object(E.a)(c);try{for(r.s();!(o=r.n()).done;){var i,u=o.value,l=ce(u.type),s={who:a,vector:[0,0],state:e,self:u};n.push.apply(n,Object(g.a)((null===(i=l.equip)||void 0===i?void 0:i.call(l,s))||[]))}}catch(d){r.e(d)}finally{r.f()}return{actions:n,objects:e.objects}},Ee=function(e,t,n){var a=e.objects,o=C(a,t);return{objects:a.map((function(e){return e!==o?e:Object(y.a)({},e,{data:Object(y.a)({},e.data,{},n)})})),actions:[]}},ye=Object(p.a)((function(e,t){return e.pipe(Object(h.a)(se.match),Object(h.a)((function(){return!t.value.game.queueStared})),Object(b.a)(de()))}),(function(e,t){return e.pipe(Object(h.a)(de.match),Object(j.a)((function(){return Object(M.first)(t.value.game.queue)})),Object(j.a)((function(e){return e?pe(e):fe()})))}),(function(e,t){return e.pipe(Object(h.a)(pe.match),Object(v.a)((function(e){var t;return Object(f.a)(Object(m.a)(e.payload),Object(m.a)(de()).pipe(Object(O.a)((null===(t=e.meta)||void 0===t?void 0:t.delay)||50)))})))})),we=n(89),_e=n(90),Ie=Object(p.a)((function(e){return e.pipe(Object(h.a)(me.match),Object(h.a)((function(e){return"player"===e.payload.targetId})),Object(we.a)((function(){return(e=.1)&&(W.volume=e),void W.play();var e})),Object(_e.a)())}),(function(e){return e.pipe(Object(h.a)(je.match),Object(we.a)((function(){return V("Hero_2",.7)})),Object(_e.a)())})),qe=Object(d.a)(),Ce=Object(s.composeWithDevTools)({name:"App"}),Se=Object(l.combineReducers)({game:Oe}),ke=Object(l.createStore)(Se,Ce(Object(l.applyMiddleware)(qe)));qe.run(Object(p.a)(Ie,ye));var xe=function(){var e=Object(u.c)((function(e){return e.game})),t=Object(u.b)();return Object(y.a)({},e,{move:function(n){if(!e.queueStared){var a=[],o=C(e.objects,"player");if(!o)return console.warn("Player don't exists [".concat("player","]"));Object(M.isEqual)(o.rotation,n)?a.push(me({targetId:"player",vector:n})):a.push(he({targetId:"player",rotation:n})),t(se(a))}},equip:function(){t(se(je({targetId:"player"})))}})},Ae=function(e,t){Object(o.useEffect)((function(){var n=function(n){n.key===e&&t()};return window.addEventListener("keydown",n),function(){return window.removeEventListener("keydown",n)}}))},Me=function(e){var t=e.objects,n=xe(),a=n.move,o=n.equip,r=function(){return a(Q)},i=function(){return a(F)},u=function(){return a(J)},l=function(){return a(H)};return Ae("ArrowLeft",r),Ae("ArrowUp",i),Ae("ArrowDown",u),Ae("ArrowRight",l),Ae("Enter",o),c.a.createElement("div",{style:{position:"absolute",zIndex:100,top:0,right:0,width:480,opacity:.8}},c.a.createElement("button",{onClick:r},"\u2190"),c.a.createElement("button",{onClick:i},"\u2191"),c.a.createElement("button",{onClick:u},"\u2193"),c.a.createElement("button",{onClick:l},"\u2192"),c.a.createElement("button",{onClick:o},"equip"),c.a.createElement("div",{style:{position:"relative"}},t.map((function(e){var t=e.type,n=e.id,a=e.xy,o=(e.rotation,e.elevation,e.zIndex),r=e.data,i=ce(t).Component;return c.a.createElement("div",{key:n,style:{position:"absolute",left:60*a[0],top:60*a[1],width:60,height:60,zIndex:o}},c.a.createElement(i,{instance:e},t," ",c.a.createElement("br",null),Object(M.isEmpty)(r)?"":JSON.stringify(r,null,1)))}))))},Be=function(){return c.a.createElement("group",null,c.a.createElement("ambientLight",{intensity:2}),c.a.createElement("pointLight",{position:[6,7,8],intensity:2.2,color:new z.Color("#3a8dc2"),"shadow-mapSize-Height":"1024","shadow-mapSize-width":"1024","shadow-camera-far":30,"shadow-bias":-.01,castShadow:!0,"shadow-camera-left":-5,"shadow-camera-right":5,"shadow-camera-top":5,"shadow-camera-bottom":-5}),c.a.createElement("pointLight",{position:[1,3,5],intensity:2.2,color:new z.Color("#c86b6f")}))},Pe=function(){var e=xe().objects;Object(R.g)().gl;return c.a.createElement(c.a.Fragment,null,c.a.createElement(Me,{objects:e}),c.a.createElement(R.a,{orthographic:!0,camera:{zoom:100,fov:1075,position:[1,7,7]},onCreated:function(e){e.camera.lookAt(3,1,2),e.gl.shadowMap.type=z.PCFSoftShadowMap,e.gl.shadowMap.enabled=!0}},c.a.createElement(Be,null),c.a.createElement(o.Suspense,{fallback:c.a.createElement("mesh",null,c.a.createElement("boxBufferGeometry",{attach:"geometry",args:[.5,.5,.5]}),c.a.createElement("meshStandardMaterial",{attach:"material",color:"red"}))},e.map((function(e){var t=ce(e.type).Component3d;return c.a.createElement(t,{key:e.id,instance:e})})))))},Re=function(){return c.a.createElement(u.a,{store:ke},c.a.createElement(Pe,null))};n(84);i.a.render(c.a.createElement(Re,null),document.getElementById("root"))}},[[74,1,2]]]);
//# sourceMappingURL=main.98522728.chunk.js.map